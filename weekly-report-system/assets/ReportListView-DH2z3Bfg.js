import{d as J,u as K,x as O,v as R,c as V,o as Q,a as i,b as u,e as t,w as a,r as c,f as n,H as b,F as D,k as I,g as m,I as X,l as _,A as Z,C as ee,D as te,t as d,z,m as se,G as oe,n as ae,J as le,K as ne,p as re,E as ue,B,_ as de}from"./index-DRy33ewS.js";const ie={class:"report-list-view"},ce={class:"card-header"},_e={class:"header-actions"},pe={class:"filter-section"},me={class:"report-list"},fe={key:0,class:"empty-state"},ve={key:1},ke=["onClick"],ye={class:"report-header"},we={class:"report-title"},ge={class:"report-actions"},he={class:"report-content"},Ce={class:"report-summary"},Ve={class:"report-meta"},be={class:"work-items-count"},De={class:"total-hours"},Ie={class:"report-date"},xe={key:0,class:"work-items-preview"},Re={class:"project-name"},ze={class:"task-desc"},Be={class:"work-hours"},$e={key:0,class:"more-items"},je={key:0,class:"pagination"},Ye=J({__name:"ReportListView",setup(Fe){const $=ee(),k=K(),r=O({year:new Date().getFullYear(),status:"",keyword:""}),f=R(1),y=R(10),j=V(()=>{const s=new Set(k.reports.map(e=>e.year));return Array.from(s).sort((e,l)=>l-e)}),w=V(()=>{let s=k.reports;if(r.year&&(s=s.filter(e=>e.year===r.year)),r.status&&(s=s.filter(e=>e.status===r.status)),r.keyword){const e=r.keyword.toLowerCase();s=s.filter(l=>l.summary.toLowerCase().includes(e)||l.workItems.some(v=>v.taskDescription.toLowerCase().includes(e)))}return s.sort((e,l)=>new Date(l.createdAt).getTime()-new Date(e.createdAt).getTime())}),Y=V(()=>{const s=(f.value-1)*y.value,e=s+y.value;return w.value.slice(s,e)}),F=s=>{const e=k.projects.find(l=>l.id===s);return e?e.name:"未知项目"},H=s=>s.workItems.reduce((e,l)=>e+l.workHours,0),L=s=>re(s).format("YYYY-MM-DD HH:mm"),M=s=>{console.log("查看周报:",s)},T=s=>{$.push({path:"/report-form",query:{id:s.id}})},A=async s=>{try{await ue.confirm(`确定要删除${s.year}年第${s.week}周的周报吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),k.deleteReport(s.id)?B.success("周报删除成功"):B.error("周报删除失败")}catch{}},C=()=>{f.value=1},N=()=>{r.year=new Date().getFullYear(),r.status="",r.keyword="",f.value=1},S=s=>{f.value=s};return Q(()=>{k.initializeStore()}),(s,e)=>{const l=c("el-icon"),v=c("el-button"),g=c("el-option"),x=c("el-select"),h=c("el-col"),E=c("el-input"),P=c("el-row"),U=c("el-empty"),W=c("el-tag"),q=c("el-pagination"),G=c("el-card");return u(),i("div",ie,[t(G,null,{header:a(()=>[n("div",ce,[e[6]||(e[6]=n("span",null,"历史周报",-1)),n("div",_e,[t(v,{type:"primary",onClick:e[0]||(e[0]=o=>s.$router.push("/report-form"))},{default:a(()=>[t(l,null,{default:a(()=>[t(m(Z))]),_:1}),e[5]||(e[5]=_(" 新建周报 ",-1))]),_:1})])])]),default:a(()=>[n("div",pe,[t(P,{gutter:20},{default:a(()=>[t(h,{span:6},{default:a(()=>[t(x,{modelValue:r.year,"onUpdate:modelValue":e[1]||(e[1]=o=>r.year=o),placeholder:"选择年份",onChange:C},{default:a(()=>[(u(!0),i(D,null,I(j.value,o=>(u(),te(g,{key:o,label:`${o}年`,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(h,{span:6},{default:a(()=>[t(x,{modelValue:r.status,"onUpdate:modelValue":e[2]||(e[2]=o=>r.status=o),placeholder:"选择状态",onChange:C},{default:a(()=>[t(g,{label:"全部",value:""}),t(g,{label:"已提交",value:"submitted"}),t(g,{label:"草稿",value:"draft"})]),_:1},8,["modelValue"])]),_:1}),t(h,{span:6},{default:a(()=>[t(E,{modelValue:r.keyword,"onUpdate:modelValue":e[3]||(e[3]=o=>r.keyword=o),placeholder:"搜索周报内容...",onInput:C},{prefix:a(()=>[t(l,null,{default:a(()=>[t(m(X))]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(h,{span:6},{default:a(()=>[t(v,{onClick:N},{default:a(()=>[...e[7]||(e[7]=[_("重置筛选",-1)])]),_:1})]),_:1})]),_:1})]),n("div",me,[w.value.length===0?(u(),i("div",fe,[t(U,{description:"暂无周报数据"})])):(u(),i("div",ve,[(u(!0),i(D,null,I(Y.value,o=>(u(),i("div",{key:o.id,class:"report-item",onClick:p=>M(o)},[n("div",ye,[n("div",we,[n("h3",null,d(o.year)+"年第"+d(o.week)+"周",1),t(W,{type:o.status==="submitted"?"success":"warning",size:"small"},{default:a(()=>[_(d(o.status==="submitted"?"已提交":"草稿"),1)]),_:2},1032,["type"])]),n("div",ge,[t(v,{type:"primary",size:"small",onClick:z(p=>T(o),["stop"])},{default:a(()=>[t(l,null,{default:a(()=>[t(m(se))]),_:1}),_(" "+d(o.status==="draft"?"继续编辑":"查看详情"),1)]),_:2},1032,["onClick"]),t(v,{type:"danger",size:"small",onClick:z(p=>A(o),["stop"])},{default:a(()=>[t(l,null,{default:a(()=>[t(m(oe))]),_:1}),e[8]||(e[8]=_(" 删除 ",-1))]),_:1},8,["onClick"])])]),n("div",he,[n("p",Ce,d(o.summary),1),n("div",Ve,[n("div",be,[t(l,null,{default:a(()=>[t(m(ae))]),_:1}),_(" "+d(o.workItems.length)+" 个工时项 ",1)]),n("div",De,[t(l,null,{default:a(()=>[t(m(le))]),_:1}),_(" 总工时: "+d(H(o))+" 小时 ",1)]),n("div",Ie,[t(l,null,{default:a(()=>[t(m(ne))]),_:1}),_(" "+d(L(o.createdAt)),1)])]),o.workItems.length>0?(u(),i("div",xe,[(u(!0),i(D,null,I(o.workItems.slice(0,3),p=>(u(),i("div",{key:p.id,class:"work-item-preview"},[n("span",Re,d(F(p.projectId)),1),n("span",ze,d(p.taskDescription),1),n("span",Be,d(p.workHours)+"h",1)]))),128)),o.workItems.length>3?(u(),i("div",$e," 还有 "+d(o.workItems.length-3)+" 个工时项... ",1)):b("",!0)])):b("",!0)])],8,ke))),128))]))]),w.value.length>y.value?(u(),i("div",je,[t(q,{"current-page":f.value,"onUpdate:currentPage":e[4]||(e[4]=o=>f.value=o),"page-size":y.value,total:w.value.length,layout:"total, prev, pager, next, jumper",onCurrentChange:S},null,8,["current-page","page-size","total"])])):b("",!0)]),_:1})])}}}),Le=de(Ye,[["__scopeId","data-v-d92916c1"]]);export{Le as default};
